// Prisma Schema - Auth Service
// Database: cropfresh_auth
// Purpose: User authentication, sessions, roles

generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model - Stores all user types (Farmer, Buyer, Hauler, Agent)
model User {
  id                 Int             @id @default(autoincrement())
  phone              String          @unique @db.VarChar(15)
  name               String?         @db.VarChar(255)
  role               UserRole
  passwordHash       String?         @map("password_hash") @db.VarChar(255)
  language           String?         @default("en") @map("language_preference") @db.VarChar(10)
  isActive           Boolean         @default(true) @map("is_active")
  
  // Farmer Profile Fields (Story 2.1 - AC5)
  fullName           String?         @map("full_name") @db.VarChar(255)
  address            String?         @db.Text
  landSizeCategory   LandSizeCategory? @map("land_size_category")
  cropTypes          String[]        @map("crop_types")
  upiId              String?         @map("upi_id") @db.VarChar(100)
  profileCompletedAt DateTime?       @map("profile_completed_at") @db.Timestamptz(6)
  
  createdAt          DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt          DateTime?       @map("deleted_at") @db.Timestamptz(6)

  sessions Session[]

  @@map("users")
}

// Session Model - Active user sessions
model Session {
  id           Int       @id @default(autoincrement())
  userId       Int       @map("user_id")
  token        String    @unique @db.VarChar(500)
  refreshToken String?   @map("refresh_token") @db.VarChar(500)
  expiresAt    DateTime  @map("expires_at") @db.Timestamptz(6)
  ipAddress    String?   @map("ip_address") @db.VarChar(45)
  userAgent    String?   @map("user_agent") @db.Text
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// UserRole Enum
enum UserRole {
  FARMER
  BUYER
  HAULER
  AGENT
  ADMIN
}

// LandSizeCategory Enum (Story 2.1 - AC5)
enum LandSizeCategory {
  SMALL_FARM  // 1-2 acres
  MEDIUM_FARM // 3-5 acres
  LARGE_FARM  // 5+ acres
}
